/**
 * angular-localization :: v1.0.0 :: 2014-06-04
 * web: https://github.com/doshprompt/angular-localization
 *
 * Copyright (c) 2014 | Rahul Doshi
 * License: MIT
 */

angular.module("ngLocalize.Config",[]).value("localeConf",{basePath:"languages",defaultLocale:"en-US",sharedDictionary:"common",fileExtension:".lang.json",persistSelection:!0,cookieName:"COOKIE_LOCALE_LANG",observableAttrs:new RegExp("^data-(?!ng-|i18n)"),delimiter:"::"}),angular.module("ngLocalize.Events",[]).constant("localeEvents",{resourceUpdates:"ngLocalizeResourcesUpdated",localeChanges:"ngLocalizeLocaleChanged"}),angular.module("ngLocalize",["ngCookies","ngLocalize.Config","ngLocalize.Events","ngLocalize.InstalledLanguages"]).service("locale",["$http","$q","$log","$rootScope","$window","$cookieStore","localeConf","localeEvents","localeSupported","localeFallbacks",function(a,b,c,d,e,f,g,h,i,j){"use strict";function k(a){return a&&a.length&&new RegExp("^[\\w\\.-]+\\.[\\w\\.-]+\\w(:.*)?$").test(a)}function l(a){var b=a?a.split("."):"",c="";return b.length>1&&(c=b.slice(0,-1).join(".")),c}function m(a){var b=a?a.split("."):[],c="";return b.length&&(c=b[b.length-1]),c}function n(a){var b,c=null,d=a?a.split("."):[];if(d.length>1)for(c=x,b=0;b<d.length-1;b++){if(!c[d[b]]){c=null;break}c=c[d[b]]}return c}function o(b){var e,f=b?b.split("."):"",i=x,j=g.basePath+"/"+v;if(f.length>1){for(e=0;e<f.length-1;e++)i[f[e]]||(i[f[e]]={}),i=i[f[e]],j+="/"+f[e];i._loading||(i._loading=!0,j+=g.fileExtension,a.get(j).success(function(a){var c,e=l(b);for(c in a)a.hasOwnProperty(c)&&(i[c]=a[c]);delete i._loading,d.$broadcast(h.resourceUpdates),w[e]&&w[e].resolve(e)}).error(function(){c.error("[localizationService] Failed to load: "+j),delete i._loading}))}}function p(a){var c,d;return a=a||g.langFile,d=a+"._LOOKUP_",c=n(d),w[a]||(w[a]=b.defer()),c&&!c._loading?w[a].resolve(a):c||o(d),w[a].promise}function q(a){var c,d,e;if(angular.isString(a))c=a.split(",");else{if(!angular.isArray(a))throw new Error("locale.ready requires either an Array or comma-separated list.");c=a}return c.length>1?(e=[],c.forEach(function(a){e.push(p(a))}),d=b.all(e)):d=p(a),d}function r(a,b){var c=a,d=0;return b&&(angular.isArray(b)?angular.forEach(b,function(a,b){c=c.replace("%"+(b+1),a),c=c.replace("{"+(b+1)+"}",a)}):angular.forEach(b,function(a,b){++d,c=c.replace("{"+b+"}",a),c=c.replace("%"+b,a),c=c.replace("%"+d,a),c=c.replace("{"+d+"}",a)})),c=c.replace(/\n/g,"<br>")}function s(a,b){var d,e,f,h="",i=!1;return angular.isString(a)&&!b&&-1!=a.indexOf(g.delimiter)&&(f=a.split(g.delimiter),a=f[0],b=angular.fromJson(f[1])),i=k(a),i?(angular.isObject(b)||(b=[b]),d=n(a),d&&!d._loading?(e=m(a),d[e]?h=r(d[e],b):(c.info("[localizationService] Key not found: "+a),h="%%KEY_NOT_FOUND%%")):d||o(a)):h=a,h}function t(a){var b=-1!=i.indexOf(a)?a:j[a.split("-")[0]]||g.defaultLocale;b!=v&&(x={},w={},v=b,d.$broadcast(h.localeChanges,v),d.$broadcast(h.resourceUpdates),g.persistSelection&&f.put(g.cookieName,b))}function u(){return v}var v,w,x;return t(f.get(g.cookieName)||e.navigator.userLanguage||e.navigator.language),{ready:q,isToken:k,getPath:l,getKey:m,setLocale:t,getLocale:u,getString:s}}]).filter("i18n",["locale",function(a){"use strict";return function(b,c){return a.getString(b,c)}}]).directive("i18n",["locale","localeEvents","localeConf",function(a,b,c){"use strict";function d(b,c,d){var e="";a.ready(a.getPath(c)).then(function(){e=a.getString(c,d),e!==b.text()&&b.text(e)})}return function(a,e,f){var g;f.$observe("i18n",function(a,b){a&&a!=b&&d(e,a,g)}),angular.forEach(f.$attr,function(a,b){c.observableAttrs.test(a)&&f.$observe(b,function(a,c){(a&&a!=c||!g||!g[b])&&(g=g||{},g[b]=f[b],d(e,f.i18n,g))})}),a.$on(b.resourceUpdates,function(){d(e,f.i18n,g)}),a.$on(b.localeChanges,function(){d(e,f.i18n,g)})}}]).directive("i18nAttr",["locale","localeEvents",function(a,b){"use strict";return function(c,d,e){function f(b,d){var f,h=c.$eval(d),i=[];for(var j in h)f=h[j],a.isToken(f)&&-1==i.indexOf(a.getPath(f))&&i.push(a.getPath(f));a.ready(i).then(function(){var b="";for(var c in h)f=h[c],b=a.getString(f),g[c]!==b&&e.$set(c,g[c]=b)})}var g={};e.$observe("i18nAttr",function(a,b){a&&a!=b&&f(d,a)}),c.$on(b.resourceUpdates,function(){f(d,e.i18nAttr)}),c.$on(b.localeChanges,function(){f(d,e.i18nAttr)})}}]),angular.module("ngLocalize.InstalledLanguages",[]).value("localeSupported",["en-US"]).value("localeFallbacks",{en:"en-US"}),angular.module("ngLocalize.Version",[]).constant("localeVer","v1.0.0");
//# sourceMappingURL=angular-localization.min.map